# Тест-кейсы: подключение Fleet (онбординг) и список водителей

Рекомендуемые сценарии для проверки после изменений в connect-fleet, tryDiscoverParkId и онбординге.

## Подключение парка (connect-fleet)

### 1. Ключ без прав на /parks/info и /parks/list
- **Действие:** онбординг, только API-ключ (parkId и clientId пустые), ключ без scope на список парков.
- **Ожидание:** 400, `error: "parkId required"`, в теле ответа или в логах есть подсказка от Fleet (`fleetErrorCode`, `fleetErrorMessage`).
- **В UI:** сообщение с предложением ввести ID парка вручную и фрагмент ответа Fleet (например 403 / access_denied).

### 2. Ключ с несколькими парками
- **Действие:** API-ключ, у которого Fleet возвращает несколько парков в /parks/list.
- **Ожидание:** 200, парк подключён (взят первый из списка). В логах: `warning` «Несколько парков по ключу, взят первый», `parksCount: N`. В ответе при `parksCount > 1` — поле `parks: [{ id, name? }, ...]` для будущего выбора парка в UI.

### 3. Пустой parkId + успешное автоопределение
- **Действие:** только API-ключ, ключ валидный и даёт 200 на /parks/info или /parks/list с одним парком.
- **Ожидание:** 200, «Парк успешно подключён!», в БД сохранены `yandexApiKey`, `yandexParkId` (определённый), `yandexClientId` = `taxi/park/{parkId}`. В логах: `discoveredParkId`, `fromEndpoint: "parks/info"` или `"parks/list"`.

### 4. Введённый вручную clientId
- **Действие:** API-ключ + parkId (или авто) + в поле Client ID введено значение, отличное от `taxi/park/{parkId}` (например кастомный client_id из кабинета).
- **Ожидание:** 200 при валидных ключе и парке; в БД сохранён введённый `yandexClientId`, а не вычисленный. Список водителей затем запрашивается с этим clientId.

### 5. Валидация clientId на фронте
- **Действие:** в поле Client ID введена строка не в формате `taxi/park/` + id (например без префикса или с опечаткой).
- **Ожидание:** до отправки запроса показывается подсказка «Обычно выглядит как taxi/park/...»; при нажатии «Подключить» — ошибка валидации, запрос не уходит.

## Список водителей (GET /api/manager/drivers)

- После успешного подключения парка: на экране «Исполнители» при `meta.source === "fleet"` и наличии `meta.rawCount` отображается «Fleet вернул N записей, отображено M» (N = rawCount, M = count), что позволяет отличить пустой ответ Fleet от проблемы парсинга.
